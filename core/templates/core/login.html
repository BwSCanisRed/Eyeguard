{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <title>{% trans "Iniciar Sesión" %} - EyeGuard</title>
    <style>
        :root{
            --bg:#0f1724; /* dark blue background */
            --card:#0f1724;
            --muted:#9aa4b2;
            --accent-green: #27ae60;
            --accent-magenta: #7b2cbf;
            --white: #ffffff;
            --radius: 12px;
            --glass: rgba(255,255,255,0.04);
        }
        html,body{height:100%;margin:0}
        body{
            font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
            background: linear-gradient(180deg, #071026 0%, #0b1220 60%);
            display:flex;align-items:center;justify-content:center;padding:32px;color:var(--white)
        }
        .login-container{
            width:100%;max-width:420px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
            padding:28px;border-radius:var(--radius);box-shadow:0 10px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.04)
        }
        .brand{display:flex;align-items:center;gap:12px;margin-bottom:18px}
        .brand .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent-green),var(--accent-magenta));display:flex;align-items:center;justify-content:center;font-weight:700}
        h1{font-size:1.25rem;margin:0}
        p.lead{color:var(--muted);margin:6px 0 18px}
    .form-group{margin-bottom:12px}
    label{display:block;color:var(--muted);font-size:0.85rem;margin-bottom:6px}
    input{width:100%;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--white);outline:none}
    select{width:100%;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.95);color:#0b1220}
    select option{color:#0b1220;background:#fff}
        input::placeholder{color:rgba(255,255,255,0.35)}
        button.primary{width:100%;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent-green),var(--accent-magenta));color:var(--white);font-weight:600;cursor:pointer}
        .messages{list-style:none;padding:0;margin:12px 0}
        .messages li{background:rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:#ffdede}
        .foot{margin-top:14px;text-align:center;color:var(--muted);font-size:0.85rem}
        .language-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            background: var(--glass);
            padding: 8px 12px;
            border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .language-selector button {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
            padding: 6px 12px;
            border-radius: 8px;
            color: var(--muted);
        }
        .language-selector button:hover {
            transform: scale(1.05);
            background: rgba(255,255,255,0.08);
            color: var(--white);
        }
        .language-selector button.active {
            background: var(--accent-green);
            color: var(--white);
        }
    </style>
</head>
<body>
    <div class="language-selector">
        <button onclick="changeLanguage('en')" title="English" id="lang-en">EN</button>
        <button onclick="changeLanguage('es')" title="Español" id="lang-es" class="active">ES</button>
        <button onclick="changeLanguage('de')" title="Deutsch" id="lang-de">DE</button>
        <button onclick="changeLanguage('fr')" title="Français" id="lang-fr">FR</button>
        <button onclick="changeLanguage('pt')" title="Português" id="lang-pt">PT</button>
    </div>
    <div class="login-container">
        <div class="brand">
            <div class="logo">EG</div>
            <div>
                <h1>EyeGuard</h1>
                <div class="lead">{% trans "Sistema de Monitoreo de Conductores" %}</div>
            </div>
        </div>
        <form method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label for="username">{% trans "Usuario" %}:</label>
                <input type="text" id="username" name="username" required>
            </div>

            <div class="form-group">
                <label for="password">{% trans "Contraseña" %}:</label>
                <input type="password" id="password" name="password" required>
            </div>

            <div class="form-group">
                <label for="role">{% trans "Tipo de Usuario" %}:</label>
                <select id="role" name="role" required>
                    {% for role_value, role_name in roles %}
                        <option value="{{ role_value }}">{{ role_name }}</option>
                    {% endfor %}
                </select>
            </div>

            {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            <button type="submit" class="primary">{% trans "Iniciar Sesión" %}</button>
        </form>
        <div class="foot">
            {% trans "¿Olvidaste tu contraseña?" %} <a href="{% url 'password_reset' %}">{% trans "Recuperar contraseña" %}</a>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const currentLang = getCookie('django_language') || 'es';
            document.querySelectorAll('.language-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeBtn = document.getElementById('lang-' + currentLang);
            if (activeBtn) activeBtn.classList.add('active');
        });

        function changeLanguage(langCode) {
            document.cookie = 'django_language=' + langCode + '; path=/; max-age=31536000';
            
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{% url "set_language" %}';
            
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = '{{ csrf_token }}';
            
            const langInput = document.createElement('input');
            langInput.type = 'hidden';
            langInput.name = 'language';
            langInput.value = langCode;
            
            const nextInput = document.createElement('input');
            nextInput.type = 'hidden';
            nextInput.name = 'next';
            nextInput.value = window.location.pathname;
            
            form.appendChild(csrfInput);
            form.appendChild(langInput);
            form.appendChild(nextInput);
            document.body.appendChild(form);
            form.submit();
        }
        
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>
